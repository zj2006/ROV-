# ROV 动力学模型说明（当前版本）

## 1. 模型范围

当前模型为 **4DOF**：
- 平移：`x, y, z`
- 旋转：`yaw`（绕 z 轴）

速度状态：
- 线速度：`u, v, w`（体坐标系）
- 角速度：`r`（绕 z）

状态向量可写为：
\[
\eta=[x,y,z,\psi],\quad \nu=[u,v,w,r]
\]

代码位置：`rov/dynamics.py`

---

## 2. 推进器配置

总计 6 推进器：
- 水平推进器 4 个（用于 `Fx, Fy, Mz`）
- 垂直推进器 2 个（用于 `Fz`，并对 `Mz` 有微弱耦合）

推力到广义力映射：
\[
\tau=[F_x, F_y, F_z, M_z]^T = B f
\]
其中 `f` 为 6 推进器推力向量，`B` 为分配矩阵。

代码位置：`rov/dynamics.py#L41-L49`

---

## 3. 动力学方程（简化）

对每个自由度采用“惯性 + 二次阻尼”形式：
\[
\dot{u}=\frac{F_x-d_u u|u|}{m_u},\;
\dot{v}=\frac{F_y-d_v v|v|}{m_v},\;
\dot{w}=\frac{F_z-d_w w|w|}{m_w},\;
\dot{r}=\frac{M_z-d_r r|r|}{I_r}
\]

再将体速度旋转到世界系，并叠加流场速度：
\[
\dot{p}_{world} = R_z(\psi)[u,v,w]^T + v_{current}(x,y,z,t)
\]

代码位置：
- 动力学积分：`rov/dynamics.py#L59-L88`
- 流场模型：`env/ocean_env.py#L57-L62`

---

## 4. 推进器分配

控制器先给出期望广义力 `tau`，再通过伪逆求推进器命令：
\[
f = B^+\tau
\]
随后进行饱和限幅。

代码位置：`rov/dynamics.py#L51-L54`

---

## 5. 已建模/未建模边界

已建模：
- 4DOF 基础动力学
- 二次阻尼
- 时变海流影响
- 推进器饱和

未建模（后续可扩展）：
- 附加质量矩阵
- 完整科氏/离心项
- 浮力重力偏置与恢复力矩
- 推进器一阶动态与效率衰减
- 传感器噪声与状态估计器

该模型适合当前“路径规划 + 控制流程验证”，不等价于实海试高保真水动力仿真。
